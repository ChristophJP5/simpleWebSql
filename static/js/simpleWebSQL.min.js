/*
 *
 * Developed by Christoph Polenz
 * http://chrisjp.kochab.uberspace.de
 * This Lines must be kept in the file
 *
 */
if("undefined"!=typeof DBNAME)var _db=openDatabase(DBNAME,"1.0","Database designed generated By ChristophJP",2097152),db={fetchAll:function(e,t,r){this.fetch(e,"all",t,r)},fetchOne:function(e,t,r){this.fetch(e,"one",t,r)},fetchRow:function(e,t,r){this.fetch(e,"row",t,r)},fetchArray:function(e,t,r){this.fetch(e,"array",t,r)},fetch:function(e,t,r,s){("row"==t||"one"==t)&&-1==e.indexOf("LIMIT ")&&(e+=" LIMIT 1"),db.execute(e,r,function(e,r){switch(t){case"array":for(r=r.rows,keys=Object.keys(r),value=[],a=0;a<keys.length;a++)for(row=r[a],rowKeys=Object.keys(row),b=0;b<rowKeys.length;b++)value.push(row[rowKeys[b]]);break;case"row":value=r.rows[0];break;case"one":r=r.rows[0],keys=Object.keys(r),value=r[keys[0]];break;case"all":value=r.rows}s(value)})},execute:function(e,t,r){_db.transaction(function(s){success=r?r:db.successHandler,t||(t=[]),s.executeSql(e,t,success,db.errorHandler)})},"delete":function(e,t,r){for(statement="DELETE FROM "+e+" WHERE ",prepareArray=[],whereKeys=Object.keys(t),a=0;a<whereKeys.length;a++)whereKey=whereKeys[a],a>0&&(statement+=" AND "),statement+=whereKey+" = ?",prepareArray.push(t[whereKey]);r&&(statement+=" LIMIT "+r),db.execute(statement,prepareArray)},update:function(t,r,s){function n(e,r){for(statement="UPDATE "+t+" SET ",dataKeys=Object.keys(e),setString=whereString="",prepareArray=[],a=0;a<dataKeys.length;a++)dataKey=dataKeys[a],setString+=dataKey+" = ?, ",prepareArray.push(e[dataKey]);if(statement+=setString.substr(0,setString.length-2),whereKeys=Object.keys(r),whereKeys.length>0)for(statement+=" WHERE ",a=0;a<whereKeys.length;a++)whereKey=whereKeys[a],a>0&&(statement+=" AND "),statement+=whereKey+" = ?",prepareArray.push(r[whereKey]);return db.execute(statement,prepareArray),!0}if(me=this,Array.isArray(r))for(e=0;e<r.length;e++)n(r[e],s[e]);else n(r,s)},truncate:function(e){if("string"==typeof e)this.execute("TRUNCATE TABLE "+data);else for(a=0;a<e.length;a++)statement="TRUNCATE TABLE "+e[a],db.execute(statement)},insert:function(e,t,r){for(insertKeys=Object.keys(t),a=0;a<insertKeys.length;a++){for(insertKey=insertKeys[a],insertQuery=prepareQuery="(",query=r?"replace"==r?"REPLACE INTO ":"INSERT IGNORE INTO ":"INSERT INTO ",query+=e+" ",colums=t[insertKey],columNames=Object.keys(colums),columValues=[],b=0;b<columNames.length;b++)if(columName=columNames[b],insertQuery+=columName+", ",prepareQuery+="?, ",columKeys=Object.keys(colums),columKeys.length<2)columValues=colums[columName];else{for(d=0;d<columKeys.length;d++)columValues[d]=colums[columKeys[d]];columValues=[columValues]}if(insertQuery=insertQuery.substr(0,insertQuery.length-2)+")",prepareQuery=prepareQuery.substr(0,prepareQuery.length-2)+")",query+=insertQuery+" VALUES"+prepareQuery,"object"==typeof columValues)if(columValues.length>1)for(c=0;c<columValues.length;c++)this.execute(query,[columValues[c]]);else for(c=0;c<columValues.length;c++)this.execute(query,columValues[c]);else this.execute(query,[columValues])}},create:function(e){for(tablenames=Object.keys(e),a=0;a<tablenames.length;a++){if(tableName=tablenames[a],query="CREATE TABLE IF NOT EXISTS ",query+=tableName+" (",settings=e[tableName],"object"==typeof settings)for(colums=Object.keys(settings),b=0;b<colums.length;b++){for(colname=colums[b],query+=colname+" ",columSettings=settings[colname],c=0;c<columSettings.length;c++)a,query+=columSettings[c]+" ";query=query.substr(0,query.length-1)+", "}statement=query.substr(0,query.length-2)+")".toString(),this.execute(statement)}},dropTables:function(e){if("string"==typeof e)this.execute("DROP TABLE "+e);else for(tablenames=Object.keys(e),a=0;a<tablenames.length;a++)tableName=tablenames[a],this.execute("DROP TABLE "+tableName)},errorHandler:function(e,t){console.error(t.message)},successHandler:function(){}};else alert('"DBNAME" nicht definiert');